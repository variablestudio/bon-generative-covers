<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Otwórz ksiązkę</title>
<style type="text/css">
body {
  background: rgb(150, 150, 150)
}

#canvasContainer {
  position: absolute;
  top: 50%;
  left: 50%;
}

canvas {
  background: rgba(255, 255, 255, 1);
  margin: 0 auto;
  display: block;
  margin-top: -300px;
  margin-left: -225px;
  box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);
}
</style>
<script type="text/javascript" src="js/paper.js"></script>
<script type="text/javascript" src="js/CSVToArray.js"></script>
<script type="text/paperscript" canvas="cover">
  function loadTextFile(path, callback) {
    var r = new XMLHttpRequest();
    r.open("GET", path, true);
    r.onreadystatechange = function () {
    if (r.readyState != 4 || r.status != 200) return;
      callback(r.responseText);
    };
    r.send();
  }

  function loadCSVFile(path, callback) {
    loadTextFile(path, function(data) {
      callback(CSVToArray(data));
    });
  }

  loadCSVFile("data/okladki.csv", function(data) {
    console.log(JSON.stringify(data.shift()));

    var i = 0;
    function nextCover() {
      var book = data[i];
      makeCover(book[1], book[2]);
      i = (i + 1) % data.length;

      setTimeout(nextCover, 1000);
    }

    nextCover();
  });

  function clear() {
    project.activeLayer.remove();
    var layer = new Layer();
  }

  function formatAuthorName(name) {
    var tokens = name.split(', ');
    if (tokens.length == 2)
      return tokens[1] + ' ' + tokens[0];
    else
      return tokens[0];
  }

  function makeCover(author, title) {
    clear();

    var niceBlue = "#27D1E7";
    var paleYellow = "rgb(255, 255, 240)";

    var margins = 0;
    var rect = new Path.Rectangle(new Point(margins,margins), view.size - new Size(2 * margins, 2 * margins));
    rect.fillColor = niceBlue;

    var path = new Path();
    path.strokeColor = 'black';
    var start = new Point(view.size.width/2, 0);
    path.moveTo(start);
    path.lineTo([0, view.size.width/2]);

    var authorText = new PointText(new Point(50, 100));
    authorText.justification = 'left';
    authorText.content = formatAuthorName(author);
    authorText.characterStyle = {
      fontSize: 20,
      fillColor: paleYellow,
    };

    var titleWords = title.split(' ');

    titleWords.forEach(function(word, wordIndex) {
      var titleText = new PointText(new Point(50, 200 + wordIndex * 75));
      titleText.justification = 'left';
      titleText.content = word;
      titleText.characterStyle = {
        fontSize: 50,
        fillColor: paleYellow,
      };
    });

    view.draw();
  }

</script>
</head>
<body>
  <div id="canvasContainer">
    <canvas id="cover" width="450" height="600"></canvas>
  </div>
</body>
</html>